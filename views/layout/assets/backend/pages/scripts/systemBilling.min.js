var SystemBillingJScripts = function() {

    var globalURLEasyBilling = localStorage.getItem(globalURLEasyBilling);
    
        var ConfirmRegisterBilling = function(){
            
            function validaSoloNumerico(cadena){
                var patron = /^[0-9]+([.][0-9]+)?$/;
                if(!cadena.search(patron))
                  return true;
                else
                  return false;
            }
            
            function validaSoloTexto(cadena){
              var patron = /^[a-zA-Z]*$/;
              // En caso de querer validar cadenas con espacios usar: /^[a-zA-Z\s]*$/
              if(!cadena.search(patron))
                return true;
              else
                return false;
            }
            
            $('#systembilling-form-datainvoice').submit(function(event){
                //alert('enviar form');
                var data = new FormData(this);
                $.ajax({
                    url: globalURLEasyBilling + 'systemBilling/dataBilling/',
                    data: data,
                    processData: false,
                    contentType: false,
                    type: 'POST',
                    beforeSend: function(){
                        //alert('Verificar los datos del video que se registra');
                    },
                    success: function(resultado){
                    alert(resultado);
                       window.location = globalURLEasyBilling + 'systemBilling/' + resultado;
                        /*setTimeout(function(e){
                            window.location = globalURLCDMesaGConnection + 'adminvideostore';
                            e.preventDefault();
                        },3000);*/
                    }
                });
            event.preventDefault();              
            });
        };
    
        var RegisterNewBilling = function(){
            
            var vCount = 0;
            
            $('#btnNewBilling').on('click', function(event){
                
                var vCodActivityNew = document.getElementById('vCodActivityNew').value;
                
                if(vCount == 0){
                    if(vCodActivityNew != 0){
                        vCount = vCount +1;
                        $('#btnNewBilling').attr('disabled', 'true');

                        $.post(globalURLEasyBilling + 'systemBilling/registerNewBilling/', {vCodActivity:vCodActivityNew}, function(dataPostResult) {
                            alert(globalURLEasyBilling + 'systemBilling/newBilling/' + dataPostResult);
                            window.location = globalURLEasyBilling + 'systemBilling/newBilling/' + dataPostResult + '/' + vCodActivityNew;
                        });
                    } else {
                        alert('Debe seleccionar la actividad que desea facturar.');
                    }
                }
                
                event.preventDefault();
            });
        };    
    
        var BillingDetailDataInsert = function(){
            
            function validaSoloNumerico(cadena){
                var patron = /^[0-9]+([.][0-9]+)?$/;
                if(!cadena.search(patron))
                  return true;
                else
                  return false;
            }
            
            function validaSoloTexto(cadena){
              var patron = /^[a-zA-Z]*$/;
              // En caso de querer validar cadenas con espacios usar: /^[a-zA-Z\s]*$/
              if(!cadena.search(patron))
                return true;
              else
                return false;
            }            
            
            $('#submitFormDetail').click(function(event){
                var vNumBilling = document.getElementById('vNumBilling').value;
                var vCodActivity = document.getElementById('vCodActivity').value;
                var vCodService = document.getElementById('vCodService').value;
                var vClientName = document.getElementById('vClientName').value;
                var vIDClient = document.getElementById('vIDClient').value;
                var vDateTransactionBilling = document.getElementById('vDateTransactionBilling').value;
                
                if((vCodActivity == '') || (vCodActivity == 0) || (vCodActivity == null)){
                    alert('Debe seleccionar la actividad que deseas facturar!');
                    return false;
                }               
                
                if((vClientName == '') || (vClientName == 0) || (vClientName == null)){
                    alert('Debe registrar el nombre del cliente!');
                    return false;
                }                
                
                if((vIDClient == '') || (vIDClient == null)){
                    alert('Debe registrar el NIT del cliente, si no tiene ingrese cero "0".');
                    return false;
                }                
                
                var vQuantity = document.getElementById('vQuantity').value;
                var vDetail = document.getElementById('vDetail').value;
                var vAmount = document.getElementById('vAmount').value;
                
                if((vQuantity == '') || (vQuantity == 0) || (vQuantity == null)){
                    alert('Debe registrar la cantidad!');
                    return false;
                }
                
                if((vCodService == '') || (vCodService == 0) || (vCodService == null)){
                    alert('Debe seleccionar el servicio!');
                    return false;
                }
                
                if((vDetail == '') || (vDetail == 0) || (vDetail == null)){
                    alert('Debe registrar el detalle de la venta!');
                    return false;
                } 
                
                if((vAmount == '') || (vAmount == 0) || (vAmount == null)){
                    alert('Debe registrar el monto de la venta!');
                    return false;
                }
                
                if(validaSoloNumerico(vQuantity) == false){
                    alert('La cantidad ingresada no es válida, por favor ingresa solo números!');
                    return false;                    
                }
                
                if(validaSoloNumerico(vAmount) == false){
                    alert('El monto ingresado no es válido, por favor ingresa solo números!');
                    return false;                    
                }
                
                $.post(globalURLEasyBilling + 'systemBilling/dataBillingDetails/', {vCodActivity:vCodActivity, vCodService:vCodService, vNumBilling:vNumBilling, vClientName:vClientName, vIDClient:vIDClient, vDateTransactionBilling:vDateTransactionBilling, vQuantity:vQuantity, vDetail:vDetail, vAmount:vAmount}, function(data) {
                    alert(data);
                    window.location = globalURLEasyBilling + 'systemBilling/newBilling/' + data;
                });
                event.preventDefault();
            });
        };
    
        var BillingDetailDelete = function(){           
            
            $('[id^=deleteBillingDetail-]').click(function(event){
                if(confirm('¿Realmente deseas eliminar este registro de la factura?') == true){
                    return true;
                } else {
                    return false;
                }                 
                event.preventDefault();
            });
        };
    
        var BillingActivityDetail = function(){           
            
            $('#vCodActivity').change(function(event){
                $("#vCodActivity option:selected").each(function(){
                    vCodActivity = $(this).val();
                    $.post(globalURLEasyBilling + 'systemBilling/getActivityServices/', {vCodActivity:vCodActivity}, function(data){
                        $("#vCodService").append(data);
                    });
                });
                event.preventDefault();
            });                
        };
    
        var GenerateFileCiclicProcess = function(){
            
            $('#btnGenerateFile').on('click', function(event){
                $.post(globalURLEasyBilling + 'systemBilling/generateFileCiclicProcess/', function(data){
                    alert(data);
                });                                    
                event.preventDefault();
            });
        };
    
        var RegisterPrincipalKeys = function(){
            
            $('#systembilling-form-principalkeys').submit(function(event){
                //alert('enviar form');
                var data = new FormData(this);
                $.ajax({
                    url: globalURLEasyBilling + 'systemBilling/registerAutorizationCode/',
                    data: data,
                    processData: false,
                    contentType: false,
                    type: 'POST',
                    beforeSend: function(){
                        //alert('Verificar los datos del video que se registra');
                    },
                    success: function(resultado){
                    alert(resultado);
                       window.location = globalURLEasyBilling + 'systemBilling/principalKeys/';
                    }
                });
            event.preventDefault();              
            });
        };
    
        var CancelDataInvoice = function(){           
            
            $('#cancelDataInvoice').click(function(event){
                if(confirm('¿Realmente deseas cancelar el registro de esta factura?') == true){
                    
                    var vNumBilling = document.getElementById('vNumBilling').value;
                    var vCodActivity = document.getElementById('vCodActivity').value;
                    
                    $.post(globalURLEasyBilling + 'systemBilling/cancelDataInvoice/', {vCodActivity:vCodActivity, vNumBilling:vNumBilling}, function(data){
                        window.location = globalURLEasyBilling + 'systemBilling';
                    });
                    
                    return true;
                } else {
                    return false;
                }                 
                event.preventDefault();
            });
        };    
    
	return {
		init: function() {
			ConfirmRegisterBilling(), RegisterNewBilling(), BillingDetailDataInsert(), BillingDetailDelete(), BillingActivityDetail(), GenerateFileCiclicProcess(), RegisterPrincipalKeys(), CancelDataInvoice();
		}
	}
}();
jQuery(document).ready(function() {
	SystemBillingJScripts.init()
});